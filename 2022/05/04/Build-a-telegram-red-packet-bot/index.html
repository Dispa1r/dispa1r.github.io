<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Build a telegram red packet bot | DravenLu</title><meta name="keywords" content="NEAR,Telegram bot"><meta name="author" content="Dispa1r"><meta name="copyright" content="Dispa1r"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="How to write a telegram red packect bot on NEARIn this tutorial, i will show you how to write a telegram red packect of near. There will be two parts, the contract and the robot part :) Ready to workB">
<meta property="og:type" content="article">
<meta property="og:title" content="Build a telegram red packet bot">
<meta property="og:url" content="https://dispa1r.github.io/2022/05/04/Build-a-telegram-red-packet-bot/index.html">
<meta property="og:site_name" content="DravenLu">
<meta property="og:description" content="How to write a telegram red packect bot on NEARIn this tutorial, i will show you how to write a telegram red packect of near. There will be two parts, the contract and the robot part :) Ready to workB">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg">
<meta property="article:published_time" content="2022-05-04T11:04:21.000Z">
<meta property="article:modified_time" content="2022-05-04T11:05:08.421Z">
<meta property="article:author" content="Dispa1r">
<meta property="article:tag" content="NEAR">
<meta property="article:tag" content="Telegram bot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://dispa1r.github.io/2022/05/04/Build-a-telegram-red-packet-bot/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Build a telegram red packet bot',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-04 19:05:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://lh3.googleusercontent.com/WO1GMB2JeMcJnRdp8gthoxpF_pLHnceekNZdlqYBcwoArMMxnEVFxpytRjsXI-oJFR3BoepLBPGes1MO6VafBNwWxgRzIBMw1YcVjw=s0" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">DravenLu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Build a telegram red packet bot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-04T11:04:21.000Z" title="发表于 2022-05-04 19:04:21">2022-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-04T11:05:08.421Z" title="更新于 2022-05-04 19:05:08">2022-05-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Build a telegram red packet bot"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="How-to-write-a-telegram-red-packect-bot-on-NEAR"><a href="#How-to-write-a-telegram-red-packect-bot-on-NEAR" class="headerlink" title="How to write a telegram red packect bot on NEAR"></a>How to write a telegram red packect bot on NEAR</h1><p>In this tutorial, i will show you how to write a telegram red packect of near. There will be two parts, the contract and the robot part :)</p>
<h2 id="Ready-to-work"><a href="#Ready-to-work" class="headerlink" title="Ready to work"></a>Ready to work</h2><p>Before develop on near, you should have a testnet account to deploy and call the contract. You can register it at <a target="_blank" rel="noopener" href="https://wallet.testnet.near.org/">NEAR testnet</a>.</p>
<p>And then, you should have <code>near-cli</code> and rust tool chain on your computer.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># install rust tool chain</span><br><span class="line">curl --proto &#x27;=https&#x27; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><br><span class="line">rustup target add wasm32-unknown-unknown</span><br><span class="line"># install near-cli</span><br><span class="line">npm install near-cli -g</span><br><span class="line"># login the near account</span><br><span class="line">near login</span><br></pre></td></tr></table></figure>
<h2 id="Contract"><a href="#Contract" class="headerlink" title="Contract"></a>Contract</h2><p>You may need a little experience in rust development, but if you are someone who is not familiar with the rust language, but has a certain foundation of object-oriented programming, you don’t need to worry, because the contract code becomes very readable with the help of comments。</p>
<p>First we can find there has been a linkdrop contract deployed on both near testnet and mainnet. And we can find the repo of linkdrop <a target="_blank" rel="noopener" href="https://github.com/near/near-linkdrop">here</a>.</p>
<p>First, we need to to analyse the code of contract. First, we need to understand how it stores the data. We should read the struct part first.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#[near_bindgen]</span><br><span class="line">#[derive(Default, BorshDeserialize, BorshSerialize)]</span><br><span class="line">pub struct LinkDrop &#123;</span><br><span class="line">    pub accounts: Map&lt;PublicKey, Balance&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The contract uses a map to store the public key and balance, it means how many near can someone who owns the private key corresponding to the public key get.Let us analyse the send function first :).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#[payable]</span><br><span class="line">pub fn send(&amp;mut self, public_key: Base58PublicKey) -&gt; Promise &#123;</span><br><span class="line">    assert!(</span><br><span class="line">        env::attached_deposit() &gt; ACCESS_KEY_ALLOWANCE,</span><br><span class="line">        &quot;Attached deposit must be greater than ACCESS_KEY_ALLOWANCE&quot;</span><br><span class="line">    );</span><br><span class="line">    let pk = public_key.into();</span><br><span class="line">    let value = self.accounts.get(&amp;pk).unwrap_or(0);</span><br><span class="line">    // insert the public key and balance into contract</span><br><span class="line">    self.accounts.insert(</span><br><span class="line">        &amp;pk,</span><br><span class="line">        &amp;(value + env::attached_deposit() - ACCESS_KEY_ALLOWANCE),</span><br><span class="line">    );</span><br><span class="line">    // the call back function</span><br><span class="line">    Promise::new(env::current_account_id()).add_access_key(</span><br><span class="line">        pk,</span><br><span class="line">        ACCESS_KEY_ALLOWANCE,</span><br><span class="line">        env::current_account_id(),</span><br><span class="line">        b&quot;claim,create_account_and_claim&quot;.to_vec(),</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can see that the parameter of the call is a public key, so before we call this function, we need to use near sdk to create a valid near key pair, and we seed the public key to the contract, give the private key to the people who we want to give the linkdrop. Let us see what the <code>add_access_key</code> function does.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/// Add an access key that is restricted to only calling a smart contract on some account using</span><br><span class="line">/// only a restricted set of methods. Here `method_names` is a comma separated list of methods,</span><br><span class="line">/// e.g. `b&quot;method_a,method_b&quot;`.</span><br><span class="line">pub fn add_access_key(</span><br><span class="line">    self,</span><br><span class="line">    public_key: PublicKey,</span><br><span class="line">    allowance: Balance,</span><br><span class="line">    receiver_id: AccountId,</span><br><span class="line">    method_names: Vec&lt;u8&gt;,</span><br><span class="line">) -&gt; Self &#123;</span><br><span class="line">    self.add_action(PromiseAction::AddAccessKey &#123;</span><br><span class="line">        public_key,</span><br><span class="line">        allowance,</span><br><span class="line">        receiver_id,</span><br><span class="line">        method_names,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function will add a access key to the contract account. Public_key is the key we just created, people who use the corresponding private key to sign the transaction could call the <code>claim</code> function and <code>create_account_and_claim</code> function. So we can know the linkdrop contract use a keypair to confirm the safety of the linkdrop. People who owns the private key could get the balance of the drop.</p>
<h2 id="a-little-upgrade"><a href="#a-little-upgrade" class="headerlink" title="a little upgrade"></a>a little upgrade</h2><p>We can see that now the contract only can give one people linkdrop, maybe we could make it more cool. We can transform the contract to allow multiple users to receive the same red envelope, it’s the same as WeChat’s lucky red envelope. So we should add some different functions.</p>
<p>First, we should change the parameter: from single <code>Base58PublicKey</code> to a vector <code>Vec&lt;Base58PublicKey&gt;</code>, and set how many people can receive. Then we just need to change adding a record to the map from before to add multiple records. So, the <code>sendLuck</code> function should become as following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pub fn send_luck(&amp;mut self, public_key: Vec&lt;Base58PublicKey&gt;, num: u128) -&gt; Promise &#123;</span><br><span class="line">        assert!(</span><br><span class="line">            env::attached_deposit() &gt; ACCESS_KEY_ALLOWANCE * num,</span><br><span class="line">            &quot;Attached deposit must be greater than ACCESS_KEY_ALLOWANCE&quot;</span><br><span class="line">        );</span><br><span class="line">        let mut copy = public_key;</span><br><span class="line">        let mut number = 0;</span><br><span class="line">        let mut person = num;</span><br><span class="line">        // evenly divide the balance</span><br><span class="line">        let mut avgAmount = remain_num / person;</span><br><span class="line">        while number != num &#123;</span><br><span class="line">            let pk   = copy.pop().unwrap().into();</span><br><span class="line">            let value = self.accounts.get(&amp;pk).unwrap_or(0);</span><br><span class="line">            let third = v.pop();</span><br><span class="line">            self.accounts.insert(</span><br><span class="line">                &amp;pk,</span><br><span class="line">                avgAmount),</span><br><span class="line">            );</span><br><span class="line">            Promise::new(env::current_account_id()).add_access_key(</span><br><span class="line">                pk,</span><br><span class="line">                ACCESS_KEY_ALLOWANCE,</span><br><span class="line">                env::current_account_id(),</span><br><span class="line">                b&quot;claim,create_account_and_claim&quot;.to_vec(),</span><br><span class="line">            );</span><br><span class="line">            number += 1;</span><br><span class="line">        &#125;</span><br><span class="line">        Promise::new(env::current_account_id())</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>But we should make the game more exciting. We should make the amount of red envelopes received by everyone random. At the same time, the amount of red envelopes received by each person should be satisfied with the mean distribution. </p>
<p>Therefore, we can implement a double mean method, but the random number part may be unfortunate. In order to meet the consensus, there is no real random number on the blockchain, but you can rely on the oracle of <code>chainlink</code> to obtain a secure random number. However, the NEAR chain currently does not support <code>chainlink</code>. We believe in that it should be possible to use <code>chainlink</code> NEAR in the near future, so we use <code>block_timeStamp</code> to get a pseudo-random number.</p>
<p>So the code after upgrading should be like this:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#[payable]</span><br><span class="line">   pub fn send_luck(&amp;mut self, public_key: Vec&lt;Base58PublicKey&gt;, num: u128) -&gt; Promise &#123;</span><br><span class="line">       assert!(</span><br><span class="line">           env::attached_deposit() &gt; ACCESS_KEY_ALLOWANCE * num,</span><br><span class="line">           &quot;Attached deposit must be greater than ACCESS_KEY_ALLOWANCE&quot;</span><br><span class="line">       );</span><br><span class="line">       let mut copy = public_key;</span><br><span class="line">       let mut number = 0;</span><br><span class="line">       let mut remain_num = env::attached_deposit() - num * ACCESS_KEY_ALLOWANCE;</span><br><span class="line">       let mut v:Vec&lt;u128&gt; = Vec::new();</span><br><span class="line">       let mut person = num;</span><br><span class="line">       while number != num-1 &#123;</span><br><span class="line">           let mut avgAmount = remain_num / person;</span><br><span class="line">           let mut doubleAvgAmount = avgAmount * 2;</span><br><span class="line">           person -= 1;</span><br><span class="line">           let mut min = ACCESS_MIN_MONEY;</span><br><span class="line">           let mut max = doubleAvgAmount ;</span><br><span class="line">           let mut rand = MyRandomGenerator::default();</span><br><span class="line">           let mut timestamp = env::block_timestamp() as u128;</span><br><span class="line">           timestamp = timestamp % 100;</span><br><span class="line">           let mut currentAmount   =(rand.gen::&lt;u128&gt;() / timestamp) % max + min ;</span><br><span class="line">           v.push(currentAmount);</span><br><span class="line">           remain_num = remain_num - currentAmount;</span><br><span class="line">           number += 1;</span><br><span class="line">       &#125;</span><br><span class="line">       v.push(remain_num);</span><br><span class="line">       number = 0;</span><br><span class="line">       while number != num &#123;</span><br><span class="line">           let pk   = copy.pop().unwrap().into();</span><br><span class="line">           let value = self.accounts.get(&amp;pk).unwrap_or(0);</span><br><span class="line">           let third = v.pop();</span><br><span class="line">           self.accounts.insert(</span><br><span class="line">               &amp;pk,</span><br><span class="line">               &amp;(value + third.unwrap()),</span><br><span class="line">           );</span><br><span class="line">           Promise::new(env::current_account_id()).add_access_key(</span><br><span class="line">               pk,</span><br><span class="line">               ACCESS_KEY_ALLOWANCE,</span><br><span class="line">               env::current_account_id(),</span><br><span class="line">               b&quot;claim,create_account_and_claim&quot;.to_vec(),</span><br><span class="line">           );</span><br><span class="line">           number += 1;</span><br><span class="line">       &#125;</span><br><span class="line">       Promise::new(env::current_account_id())</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>Aha, we just finished to upgrade the contract, we don’t need to change the claim function beacuse we don’t change the storage structure.</p>
<h2 id="call-the-contract"><a href="#call-the-contract" class="headerlink" title="call the contract"></a>call the contract</h2><p>Due to space reasons, how to install and use near-js-sdk will not be introduced here, I will directly show how to call our contract in the node-js environment.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">// deploy contract function</span><br><span class="line">async function deployContract() &#123;</span><br><span class="line">    const near = await connect(config);</span><br><span class="line">    const account = await near.account(&quot;dispa1r.testnet&quot;);</span><br><span class="line">    const response = await account.deployContract(fs.readFileSync(&#x27;./linkdrop.wasm&#x27;));</span><br><span class="line">    console.log(response);</span><br><span class="line">&#125;</span><br><span class="line">const public_key = [];</span><br><span class="line">const nearPriAccount = [];</span><br><span class="line"></span><br><span class="line">## generate multiple keypair</span><br><span class="line">async function createKeyPair(newAccountId, num) &#123;</span><br><span class="line">    const keyStore1 = new keyStores.UnencryptedFileSystemKeyStore(&quot;./&quot;);</span><br><span class="line">    //const creatorAccount = await near.account(creatorAccountId);</span><br><span class="line"></span><br><span class="line">    for (i = 0; i &lt; num; i++) &#123;</span><br><span class="line">        const keyPair = KeyPair.fromRandom(&quot;ed25519&quot;);</span><br><span class="line">        await keyStore1.setKey(config.networkId, newAccountId + i, keyPair);</span><br><span class="line">        const KEY_PATH = &#x27;./testnet/&#x27; + newAccountId + i + &quot;.json&quot;;</span><br><span class="line">        const credentials = JSON.parse(fs.readFileSync(KEY_PATH));</span><br><span class="line">        //keyStore.setKey(NETWORK_ID, ACCOUNT_ID, KeyPair.fromString(credentials.private_key));</span><br><span class="line">        public_key.push(keyPair.publicKey.toString().replace(&#x27;ed25519:&#x27;, &#x27;&#x27;));</span><br><span class="line">        nearPriAccount.push(credentials.private_key.replace(&#x27;ed25519:&#x27;, &#x27;&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">    //console.log(public_key);</span><br><span class="line">    console.log(nearPriAccount);</span><br><span class="line">    //await keyStore.setKey(config.networkId, &quot;testnmsl1.testnet&quot;, keyPair)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function getContract(viewMethods = [], changeMethods = [], secretKey) &#123;</span><br><span class="line">    const near = await connect(config);</span><br><span class="line">    if (secretKey) &#123;</span><br><span class="line">        await keyStore.setKey(</span><br><span class="line">            NETWORK_ID, &quot;dispa1r.testnet&quot;,</span><br><span class="line">            nearAPI.KeyPair.fromString(secretKey)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    const tmpAccount = await near.account(&quot;dispa1r.testnet&quot;);</span><br><span class="line">    const contract = new nearAPI.Contract(tmpAccount, &quot;dispa1r.testnet&quot;, &#123;</span><br><span class="line">        viewMethods,</span><br><span class="line">        changeMethods,</span><br><span class="line">        sender: &quot;dispa1r.testnet&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    return contract</span><br><span class="line">&#125;</span><br><span class="line">async function getContract1(viewMethods = [], changeMethods = []) &#123;</span><br><span class="line">    const near = await connect(config);</span><br><span class="line">    const tmpAccount = await near.account(&quot;dispa1r.testnet&quot;);</span><br><span class="line">    const signAccount = await near.account(&quot;dispa1r1.testnet&quot;);</span><br><span class="line">    const contract1 = new nearAPI.Contract(tmpAccount, &quot;dispa1r.testnet&quot;, &#123;</span><br><span class="line">        viewMethods,</span><br><span class="line">        changeMethods,</span><br><span class="line">        sender: tmpAccount</span><br><span class="line">    &#125;)</span><br><span class="line">    return contract1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// beginning send function</span><br><span class="line">async function callSend(public_key, deposit) &#123;</span><br><span class="line">    const contract = await getContract1([], [&#x27;send&#x27;])</span><br><span class="line">    const depositNum = toNear(deposit)</span><br><span class="line">    await contract.send(&#123;</span><br><span class="line">            public_key,</span><br><span class="line">        &#125;, 200000000000000, depositNum)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;Drop claimed&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((e) =&gt; &#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">            console.log(&#x27;Unable to claim drop. The drop may have already been claimed.&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// send Luck version</span><br><span class="line">async function callSendLuck(nearAmount, num) &#123;</span><br><span class="line">    await createKeyPair(&quot;test.testnet&quot;, num);</span><br><span class="line">    const contract = await getContract1([], [&#x27;send_luck&#x27;])</span><br><span class="line">    const deposit = toNear(nearAmount);</span><br><span class="line">    //console.log(public_key);</span><br><span class="line">    await contract.send_luck(&#123;</span><br><span class="line">            public_key,</span><br><span class="line">            num,</span><br><span class="line">        &#125;, 200000000000000, deposit)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;Drop claimed&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((e) =&gt; &#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">            console.log(&#x27;Unable to claim drop. The drop may have already been claimed.&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function claimDrop(account_id, privKey) &#123;</span><br><span class="line">    const contract = await getContract([], [&#x27;claim&#x27;, &#x27;create_account_and_claim&#x27;], privKey)</span><br><span class="line">        // return funds to current user</span><br><span class="line">    await contract.claim(&#123;</span><br><span class="line">            account_id,</span><br><span class="line">        &#125;, 200000000000000)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;Drop claimed&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((e) =&gt; &#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">            console.log(&#x27;Unable to claim drop. The drop may have already been claimed.&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Robot-part"><a href="#Robot-part" class="headerlink" title="Robot part"></a>Robot part</h2><p>I do not intend to introduce the robot part in detail, because I used someone else’s golang-based telegram robot framework. It is very simple. You can find all of my code on github. If you have any questions, you can directly send me a private message via Twitter.</p>
<p>I think i should briefly introduce the robot-related code, i just make some comments.</p>
<p>The way I implemented it is very inelegant, because near does not have go-api, but in fact you can choose api-server, but I didn’t know these at the time, so I chose to go through near-js-api and go. I calling the command line command to implement the call contract. You can see the related code in <code>utils.go</code> and the js code in <code>test.js</code>.</p>
<p>In my robot, people only could send red packet after sign in and deposit near to the robot account, so i write a simple spider to check the transaction of deposit.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">b.Handle(&quot;/deposit&quot;,func(m *tb.Message) &#123;</span><br><span class="line">		b.Send(m.Sender, &quot;please transfer to the near account:dispa1r.testnet&quot;)</span><br><span class="line">		b.Send(m.Sender, &quot;after transfer, please input your txn hash&quot;)</span><br><span class="line">		b.Send(m.Sender, &quot;the deposit must be bigger than 1 near&quot;)</span><br><span class="line">		b.Handle(tb.OnText, func(m *tb.Message) &#123;</span><br><span class="line">			// all the text messages that weren&#x27;t</span><br><span class="line">			// captured by existing handlers</span><br><span class="line">			url := &quot;https://explorer.testnet.near.org/transactions/&quot; + m.Text</span><br><span class="line">			result := Get(url)</span><br><span class="line">			//fmt.Println(result)</span><br><span class="line">			reg1 := regexp.MustCompile(`&quot;receiverId&quot;:&quot;(?s:(.*?)).testnet&quot;,`)</span><br><span class="line">			result1 := reg1.FindAllStringSubmatch(result, -1)</span><br><span class="line">			receiverId := result1[0][1]</span><br><span class="line">			reg2 := regexp.MustCompile(`&quot;deposit&quot;:&quot;(?s:(.*?))&quot;,`)</span><br><span class="line">			result1 = reg2.FindAllStringSubmatch(result, -1)</span><br><span class="line">			tmp := result1[0][1]</span><br><span class="line">			numOnly := strings.TrimSuffix(tmp, &quot;\&quot;&#125;&#125;],\&quot;status\&quot;:\&quot;SuccessValue&quot;)</span><br><span class="line">			var numOnly1 string</span><br><span class="line">			numOnly1 = strings.TrimSuffix(numOnly, &quot;0000000000000000000000&quot;)</span><br><span class="line">			num,err := strconv.Atoi(numOnly1)</span><br><span class="line">			num1 := float64(num)/100</span><br><span class="line">			if err!=nil || num &lt;100&#123;</span><br><span class="line">				b.Send(m.Sender, &quot;invalid number&quot;)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			if receiverId != &quot;dispa1r&quot; &#123;</span><br><span class="line">				b.Send(m.Sender, &quot;invalid transaction&quot;)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			err = common.GenerateTxn(m.Text)</span><br><span class="line">			if err !=nil&#123;</span><br><span class="line">				b.Send(m.Sender, &quot;invalid transaction&quot;)</span><br><span class="line">				return</span><br><span class="line">			&#125;</span><br><span class="line">			common.DepositMoney(m.Sender.ID, num1)</span><br><span class="line">			num2 := strconv.FormatFloat(num1,&#x27;f&#x27;,5,32)</span><br><span class="line">			str3 := &quot;success to deposit &quot;+num2+&quot; near&quot;</span><br><span class="line">			b.Send(m.Sender, str3)</span><br><span class="line">			return</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>Then is the <code>send_luck</code> function and the <code>claim</code> function.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">b.Handle(&quot;/lucky&quot;,func(m *tb.Message) &#123;</span><br><span class="line">		//chat := m.Chat</span><br><span class="line">		b.Send(m.Sender, &quot;input the number of the near:&quot;)</span><br><span class="line">		var amount float64</span><br><span class="line"></span><br><span class="line">		b.Handle(tb.OnText, func(m *tb.Message) &#123;</span><br><span class="line">			amount,err = strconv.ParseFloat(m.Text,10)</span><br><span class="line">			result := common.CheckIfHave(m.Sender.ID,amount)</span><br><span class="line">			if err !=nil || !result&#123;</span><br><span class="line">				b.Send(m.Sender, &quot;invalid number, please go to deposit&quot;)</span><br><span class="line">			&#125;</span><br><span class="line">			b.Send(m.Sender, &quot;input the number of the red-packets:&quot;)</span><br><span class="line">			b.Handle(tb.OnText, func(m *tb.Message) &#123;</span><br><span class="line">				var num int</span><br><span class="line">				num,err = strconv.Atoi(m.Text)</span><br><span class="line">				if err !=nil&#123;</span><br><span class="line">					b.Send(m.Sender, &quot;invalid number&quot;)</span><br><span class="line">				&#125;</span><br><span class="line">				var privateKey []string</span><br><span class="line">				err,privateKey = CallSendLuckCmd(amount,num)</span><br><span class="line">				if err!=nil&#123;</span><br><span class="line">					common.SendLuck(m.Sender.ID,amount)</span><br><span class="line">				&#125;</span><br><span class="line">				b.Send(m.Sender, &quot;success to call the send luck,now give u the private key&quot;)</span><br><span class="line">				for i := range privateKey&#123;</span><br><span class="line">					b.Send(m.Sender, privateKey[i])</span><br><span class="line">				&#125;</span><br><span class="line">				return</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	b.Handle(&quot;/claim&quot;,func(m *tb.Message) &#123;</span><br><span class="line">		b.Send(m.Sender, &quot;please input the private key to claim the drop&quot;)</span><br><span class="line">		result := common.CheckBinded(m.Sender.ID)</span><br><span class="line">		if !result&#123;</span><br><span class="line">			b.Send(m.Sender,&quot;please first bind the near account&quot;)</span><br><span class="line">			return</span><br><span class="line">		&#125;</span><br><span class="line">		b.Handle(tb.OnText, func(m *tb.Message) &#123;</span><br><span class="line">			privateKey := m.Text</span><br><span class="line">			accountId := common.GetAccountId(m.Sender.ID)</span><br><span class="line">			err = CallClaim(accountId,privateKey)</span><br><span class="line">			//result := common.CheckIfHave(m.Sender.ID,amount)</span><br><span class="line">			if err !=nil || !result&#123;</span><br><span class="line">				b.Send(m.Sender, &quot;fail to claim the drop&quot;)</span><br><span class="line">			&#125;</span><br><span class="line">			b.Send(m.Sender, &quot;success to claim the drop!&quot;)</span><br><span class="line">			return</span><br><span class="line">		&#125;)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>repo address : <a target="_blank" rel="noopener" href="https://github.com/Dispa1r/NearLuckyRobot">Disp41r lucky robot</a></p>
<h2 id="conclusion"><a href="#conclusion" class="headerlink" title="conclusion"></a>conclusion</h2><p>If you are not familiar with the rust language, or even programming, then don’t worry, you can go to github to find other people’s code. </p>
<p>There are many interesting contracts in near-example, and they are also very helpful for you to learn how to develop on near. </p>
<p>After understanding the contract, try to modify it, then compile and deploy, gradually you will find that your understanding of it will be deeper. All in all, there is only one sentence, the industry is good at diligence, and more hands-on operations will make you become stronger.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Dispa1r</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://dispa1r.github.io/2022/05/04/Build-a-telegram-red-packet-bot/">https://dispa1r.github.io/2022/05/04/Build-a-telegram-red-packet-bot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://dispa1r.github.io" target="_blank">DravenLu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NEAR/">NEAR</a><a class="post-meta__tags" href="/tags/Telegram-bot/">Telegram bot</a></div><div class="post_share"><div class="social-share" data-image="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/04/Build-NEAR-app-with-Airtable-Glide/"><img class="prev-cover" src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Build NEAR app with Airtable/Glide</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/04/%E8%81%94%E7%9B%9F%E9%93%BE%E8%B7%A8%E9%93%BE%E6%96%B9%E6%A1%88%E6%9E%84%E6%83%B3/"><img class="next-cover" src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">联盟链跨链方案构想</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/04/Build-NEAR-app-with-Airtable-Glide/" title="Build NEAR app with Airtable/Glide"><img class="cover" src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-04</div><div class="title">Build NEAR app with Airtable/Glide</div></div></a></div><div><a href="/2022/05/18/The-Graph%E5%BC%80%E5%8F%91%E5%BF%83%E5%BE%97-NEAR/" title="The Graph开发心得(NEAR)"><img class="cover" src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-18</div><div class="title">The Graph开发心得(NEAR)</div></div></a></div><div><a href="/2022/06/06/NEAR-subgraph-tutorial/" title="NEAR subgraph tutorial"><img class="cover" src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-06</div><div class="title">NEAR subgraph tutorial</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://lh3.googleusercontent.com/WO1GMB2JeMcJnRdp8gthoxpF_pLHnceekNZdlqYBcwoArMMxnEVFxpytRjsXI-oJFR3BoepLBPGes1MO6VafBNwWxgRzIBMw1YcVjw=s0" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dispa1r</div><div class="author-info__description">DravenLu的小屋</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dispa1r"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dispa1r" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/lrj001228@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-write-a-telegram-red-packect-bot-on-NEAR"><span class="toc-number">1.</span> <span class="toc-text">How to write a telegram red packect bot on NEAR</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ready-to-work"><span class="toc-number">1.1.</span> <span class="toc-text">Ready to work</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Contract"><span class="toc-number">1.2.</span> <span class="toc-text">Contract</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#a-little-upgrade"><span class="toc-number">1.3.</span> <span class="toc-text">a little upgrade</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#call-the-contract"><span class="toc-number">1.4.</span> <span class="toc-text">call the contract</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Robot-part"><span class="toc-number">1.5.</span> <span class="toc-text">Robot part</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#conclusion"><span class="toc-number">1.6.</span> <span class="toc-text">conclusion</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/Falco%E5%85%A8%E8%A7%A3%E6%9E%90-%E4%B8%80/" title="Falco全解析(一)"><img src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Falco全解析(一)"/></a><div class="content"><a class="title" href="/2023/02/27/Falco%E5%85%A8%E8%A7%A3%E6%9E%90-%E4%B8%80/" title="Falco全解析(一)">Falco全解析(一)</a><time datetime="2023-02-27T08:29:20.000Z" title="发表于 2023-02-27 16:29:20">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/%E5%AF%92%E5%81%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="寒假学习笔记"><img src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="寒假学习笔记"/></a><div class="content"><a class="title" href="/2023/02/27/%E5%AF%92%E5%81%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="寒假学习笔记">寒假学习笔记</a><time datetime="2023-02-27T03:21:01.000Z" title="发表于 2023-02-27 11:21:01">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/19/Unpack-Objection%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Unpack &amp;&amp; Objection学习笔记"><img src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unpack &amp;&amp; Objection学习笔记"/></a><div class="content"><a class="title" href="/2022/07/19/Unpack-Objection%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Unpack &amp;&amp; Objection学习笔记">Unpack &amp;&amp; Objection学习笔记</a><time datetime="2022-07-19T07:30:10.000Z" title="发表于 2022-07-19 15:30:10">2022-07-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/06/%E8%B7%A8%E9%93%BE%E8%AE%BA%E6%96%87-IOTJ2021/" title="跨链论文-IOTJ2021"><img src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跨链论文-IOTJ2021"/></a><div class="content"><a class="title" href="/2022/06/06/%E8%B7%A8%E9%93%BE%E8%AE%BA%E6%96%87-IOTJ2021/" title="跨链论文-IOTJ2021">跨链论文-IOTJ2021</a><time datetime="2022-06-06T08:43:02.000Z" title="发表于 2022-06-06 16:43:02">2022-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/06/NEAR-subgraph-tutorial/" title="NEAR subgraph tutorial"><img src="https://hackmd.summershrimp.com/uploads/upload_08bfa2cc52f2471ea80a04d6788087db.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NEAR subgraph tutorial"/></a><div class="content"><a class="title" href="/2022/06/06/NEAR-subgraph-tutorial/" title="NEAR subgraph tutorial">NEAR subgraph tutorial</a><time datetime="2022-06-06T06:52:36.000Z" title="发表于 2022-06-06 14:52:36">2022-06-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Dispa1r</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>